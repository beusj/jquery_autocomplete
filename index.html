<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>jQuery UI Autocomplete - Remote datasource</title>
  <link rel="stylesheet" href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
  
<!--   <link rel="stylesheet" href="/resources/demos/style.css">
  <style>
  .ui-autocomplete-loading {
    background: white url("images/ui-anim_basic_16x16.gif") right center no-repeat;
  
  </style> -->

  
  <script src="https://code.jquery.com/jquery-1.12.4.js"></script>
  <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
  <script>

  var BP_SEARCH_SERVER = "https://bioportal.bioontology.org";
  

  //https://bioportal.bioontology.org/search/json_search/?q=adrenal&ontologies=SNOMEDCT&response=json

    /*function requestData(q) {
        if (!options.matchCase) q = q.toLowerCase();
        var data = options.cacheLength ? loadFromCache(q) : null;
        // recieve the cached data
        if (data) {
          receiveData(q, data);
        // if an AJAX url has been supplied, try loading the data now
        } else if( (typeof options.url == "string") && (options.url.length > 0) ){
          $.getJSON(makeUrl(q)+"&response=json&callback=?", function(data) {
    //                alert(data.data)
            data = parseData(data.data);
            addToCache(q, data);
            receiveData(q, data);
          });
        // if there's been no data found, remove the loading class
        } else {
          $input.removeClass(options.loadingClass);
        }
      };

      function makeUrl(q) {
        var url = options.url + "?q=" + encodeURI(q);
        for (var i in options.extraParams) {
          url += "&" + i + "=" + encodeURI(options.extraParams[i]);
        }
        return url;
      };*/
// http://stackoverflow.com/questions/20623123/links-in-contenteditable-div

  $( function() {
    function log( message ) {
      $( "<div>" ).text( message ).prependTo( "#log" );
      $( "#log" ).scrollTop( 0 );
    }
      function parseData(data) {
        if (!data) return null;
        var parsed = [];
        var rows = data.split("~!~");
        // var result = {}
        for (var i=0; i < rows.length; i++) {
          var row = $.trim(rows[i]);
          result = {};
          if (row) {
            var line = row.split("|");
            // parsed[parsed.length] = row.split("|");
            // result[parsed[5]] = parsed[1]
            result['id'] = line[5];
            result['value'] = line[5]
            result['url'] = line[1];
            // console.log({i,result});
            parsed.push(result)
          }
        }
        return parsed;
      };

    $( "#ac" ).autocomplete({
      source: function(request,response) {
        $.getJSON("https://bioportal.bioontology.org/search/json_search/?q=" + encodeURI(request.term) + "&ontologies=SNOMEDCT&response=json&callback=?",
          function(data) {
            data = parseData(data.data)
            // console.log(data);
            response(data);
          }
          )
      //   $.ajax({
      //     url: "https://bioportal.bioontology.org/search/json_search/?q=" + request.term + "&ontologies=SNOMEDCT&response=jsonp",
      //     crossDomain: true,
      //     dataType: "jsonp"
      //   },
      //   success: function(data) {
      //     response(data);
      //   }
      // )
      },
      minLength: 3
      ,
      // select: function(event, ui) {
      //   ("<a href=" + ui.item.url + ">" + ui.item.value + "</a>")
      // }
      select: function( event, ui ) {
        $("#ac").html("<span url=" + ui.item.url + ">" + ui.item.value + "</a>");
        console.log($("#ac").html())
        return false;
        // $("#log").text(ui.item.value);
      }
    });
  })
  </script>
</head>
<body>

<div class="ui-widget" style="margin-top:2em; font-family:Arial">
  Bioportal Autocomplete:
  <div contenteditable="true" id='ac' class="ui-widget-content" style="height: 50px;width: 500px; overflow: auto;">
  </div>
</div>
 
<!-- <div class="ui-widget">
  <label for="birds">Birds: </label>
  <input id="birds">
</div>
 
<div class="ui-widget" style="margin-top:2em; font-family:Arial">
  Result:
  <div id="log" style="height: 200px; width: 300px; overflow: auto;" class="ui-widget-content"></div>
</div> -->
 
 
</body>
</html>